# Starter pipeline
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Common.TestResultsDirectory)'
    includeRootFolder: true
    archiveType: 'zip'
- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(Build.ArtifactStagingDirectory)\TestResults\Screenshots'
    ArtifactName: 'Screenshots_$(Build.Repository.Name_$(Build.BuildNumber)'
    publishLocation: 'Container'
    archiveFile: '$(Build.ArtifactStagingDirectory)/Screenshots_$(Build.Repository.Name)_$(Build.BuildNumber).zip'
    replaceExistingArchive: true
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - master
  paths:
    exclude:
      - ApolloQA/*

pool:
  vmImage: 'windows-latest'

variables:
- name: Browser
  value: Chrome


steps:
- task: NuGetCommand@2
  inputs:
    command: 'restore'
    restoreSolution: '**/ApolloQA.sln'
    feedsToUse: 'select'
- task: VSBuild@1
  inputs:
    solution: '**\ApolloQA.sln'
    restoreNugetPackages: true
- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      $env:Browser = "chrome"
      Write-Host "Current Browser Value is $env:Browser"
- task: VSTest@2
  displayName: 'Running a Smoke Test'
  continueOnError: true
  timeoutInMinutes: 10
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
      **\ApolloQA.dll
      !**\*TestAdapter.dll
      !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
    testRunTitle: 'SmokeTest'
